#!/usr/bin/env bash

# find script location
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
# ensure build harness has been initialized
if [[ ! -d "${DIR}/../build-harness/bashlib" ]]; then make init; fi
# shellcheck source=./../build-harness/bashlib/bashopts.sh
source "${DIR}/../build-harness/bashlib/bashopts.sh"
# shellcheck source=./../build-harness/bashlib/bashui.sh
source "${DIR}/../build-harness/bashlib/bashui.sh"

function usage() {
  cat <<- EOF

  toggle passwordless sudo

  usage: $0 <toggle>

EOF
}

function main() {
  usr=$(whoami)
  case $TOGGLE in
    'off')
      sudo rm -rf /etc/sudoers.d/$usr
      ;;
    'on')
      echo "$usr ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/$usr
      ;;
    *)
      usage
      die
      ;;
  esac

}

[ "$#" -lt 1 ] && usage && die

TOGGLE="$1"

main "$@"
